# Development Notes

## Tech Stack

| Layer | Technology |
|-------|------------|
| **Logic** | C++ (compiled to WebAssembly via Emscripten) |
| **Fallback** | JavaScript (identical logic when WASM not built) |
| **Frontend** | HTML5, CSS3, vanilla JavaScript (ES modules) |
| **Build** | Emscripten (emcc), Make / bash |

## Project Structure

```
├── index.html      # Entry point, minimal markup
├── style.css       # Black & white styling
├── app.js          # UI logic, WASM loader, JS fallback
├── multiply.js     # Generated by build (Emscripten glue + WASM loader)
├── multiply.wasm   # Generated by build (compiled C++)
├── src/
│   └── multiply.cpp   # C++ core logic
├── build.sh        # Build script
├── Makefile        # Alternative build
├── devNotes.md     # This file
└── readMe.md       # User-facing docs
```

## How the Code Works

### 1. Question Generation (C++ / `src/multiply.cpp`)

- Uses the **difference of squares**: (a+b)(a−b) = a² − b²
- Picks a center `n` (15–85) and difference `d` so both factors are 2-digit (10–99)
- Factors: `(n−d)` and `(n+d)`
- Answer: `n² − d²`
- Deterministic LCG seeded from JavaScript for reproducible questions
- Exposed to JS via Emscripten (emscripten::function, value_object)

### 2. Emscripten Build

- `emcc` compiles C++ to WebAssembly and emits `multiply.js` (glue) and `multiply.wasm`
- `createMultiplyModule()` returns a Promise that resolves to the Module with `generateQuestion` and `checkAnswer`
- Uses `-lembind` for C++ ↔ JavaScript bindings

### 3. Frontend (`app.js`)

- Tries to load `multiply.js` and use the WASM engine
- If loading fails or `multiply.js` is missing, uses the pure JS fallback (same algorithm)
- Handles form submit, answer checking, feedback, and “Next question”

### 4. Styling (`style.css`)

- Monospace font, black background, white text
- Simple layout for question and input
- No external dependencies

## Build Instructions

### Prerequisites

1. **Emscripten SDK**
   ```bash
   git clone https://github.com/emscripten-core/emsdk.git
   cd emsdk
   ./emsdk install latest
   ./emsdk activate latest
   source ./emsdk_env.sh
   ```

2. **Serve over HTTP** (required for ES modules and WASM)
   ```bash
   python3 -m http.server 8080
   # Open http://localhost:8080
   ```

### Build

```bash
# Option 1: Make
make

# Option 2: build.sh
chmod +x build.sh
./build.sh
```

### Run Without Building

The app works without building. It uses the built-in JavaScript fallback. Build only when you want the C++/WASM version.

## API (Exposed from C++)

- `generateQuestion(seed: number) → { factor1, factor2, answer, hint }`
- `checkAnswer(userAnswer: number, correctAnswer: number) → boolean`
